
#### 本文主要阐述以下:
* ---梳理众所周知的短小函数的好处
* ---解释为什么我认为有些好处表现的并不好
* ---解释为什么短小函数是适得其反的
* ---列举我认为短小函数真正有用的场景

人们给出的编程建议似乎都在赞美短小函数的优美和简洁。比如被看做编程圣经的《clean code》一书中，有一章专门用来讲述方法。这一章用一个非常差劲的函数做开篇，这个函数就非常冗长。这一章也把函数过长看做最大的错误。书中写到：
> 这个函数不仅非常长，而且有很多重复代码、使用了很多奇怪的字符串和不常见的数据类型和api。给你三分钟，你能够理解者函数吗？答案也许是否定的。这个函数中实现了太多逻辑，有很多不同层级的抽象。在if控制语句中有太多奇怪的字符串和古怪的函数调用。

这一章探讨了哪些特性能够使代码“易于阅读和理解”、“allow a casual reader to intuit the kind of program they live inside”，在探讨这些之前简化函数也许就能够达到以上目的。

函数应该短小这个观点几乎被认为是不容置疑的。这种论点频繁出现在代码审查、twitter讨论、会议演讲、书籍播客、关于重构的文章中等等各种场景。几天前我在tweeter上看到了这种观点：

在他的tweeter上、粉丝中、还有他关于函数长度的文章中，他这样说道：
> 如果你需要花费一些力气才能读懂某一个代码片段的时候，这就意味着你应该把这段代码提取到另外一函数中去。
之前我接受了这个建议，并养成了书写短小函数的习惯，通常我的函数只有几行。多余6行代码的函数让我感觉不自在，只有一行代码的函数在我这里也是平常的了。

短小方法的关键被广泛传播，今天我又在tweeter上看到一条：
> Matin Fowler的一份关于代码注释的方案中提到：再开始注释之前，是否可以让函数达到自我注释的状态。我遵从这个原则一段时间之后发现，这对写出整洁的代码很有帮助。但是最好在想要让代码更清晰的地方去调用这种自我解释的函数。

一些人貌似非常痴迷于短小函数，以至于把所有一切哪怕看起来只是nominally complex的代码逻辑抽象成方法的做法都被热烈的拥护。

我研读过一些人写的代码库。他们把短小函数这种想法发展到了一种非常极端的程度，使得最终结果很坏甚至跟所有好的想法完全相反。在这篇文章中我希望向大家解释为什么有些常常被兜售的短小方法的益处并不会像大家想象的一样表现。而在某些场景下这种想法却被证明是适得其反的。

### 一些假定的短小函数的好处
有一大堆理由去证明更短小的函数的价值。

#### 一个函数只做一件事
这种想法非常简单——函数只做一件事并且做好。从表面看非常合理，甚至这跟UNIX的编程哲学是吻合的。

但是“一件事”的定义是模糊的。这“一件事”可以是一个简单的return语句、一个表达式、一个数学运算、或者一次网络调用。照这样来说，这个“一件事”表示仅有一个层级的抽象。

举个例子，在一个web项目中，“创建一个用户”也表示“一件事”。通常来说，这个操作至少是在db中增加一条记录。另外，创建用户也可能包含给用户发送一封欢迎邮件。此外，也许有的项目需要触发一次事件，用来通过类似kafka这种消息系统来通知其他系统。

因此，"仅有一层逻辑的抽象"并不是只有一层。我发现，那些完全接受“一个函数只做一件事”这种观念的程序员，会抑制不住的想要递归的把这种思想应用到每个函数上去。

结果就是，之前我们通常把一个合理、易于理解的抽象或者封装作为一个单元。现在却要继续切割这个单元，知道每个函数都是“只做一件事”，直接完全模块化和达到了完完全全的DRY(dont repeat yourself)(不写重复代码)。

#### 对DRY原则的误解
DRY原则和把函数做的尽量小并不完全相同，我发现把函数做小通常会最终实现DRY。在我看来DRY是一个好的编程指导原则，但是很多时候是更多的时候是一种坏的指导。如果教条的遵从DRY原则，实用主义和理智往往会被牺牲。

----------------

via：https://medium.com/@copyconstruct/small-functions-considered-harmful-91035d316c29

译者：[wkpaochuan](https://github.com/wkupaochuan)

本文由 [GCTT](https://github.com/studygolang/GCTT) 原创编译，[Go 中文网](https://studygolang.com/) 荣誉推出
